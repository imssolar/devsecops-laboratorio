name: Workflow
on:
    push:
        branches:
            - feature/devsecops

jobs:
    SAST:
      runs-on: ubuntu-latest
      steps:
        - name: checkout code
          uses: actions/checkout@v4

        - name: SonarCloud Scan
          uses: SonarSource/sonarcloud-github-action@master
          env:
            GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
            SONAR_TOKEN: ${{secrets.SONAR_TOKEN}}
        
        - name: Check for critical/High/Medium Vulnerabilities
          run: |
            RESPONSE=$(curl -s -X GET -u '${{secrets.SONAR_TOKEN}}:' 'https://sonarcloud.io/api/issues/search?componentKeys=imssolar_devsecops-laboratorio&facets=severities')

            echo "Complete Response:"
            echo "$RESPONSE" | jq '.'

            issueValidate=$(echo "$RESPONSE" | jq '.facets[0].values[1].count')
            echo "Cantidad de issues: $issueValidate"